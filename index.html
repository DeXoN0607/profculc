<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–π</title>
  <style>
    /* –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
    :root {
      --bg-primary: #f7f9fc;
      --bg-secondary: #dfe7f3;
      --bg-card: #ffffff;
      --bg-control: #fafbfc;
      --bg-disabled: #fdf0ef;
      --text-primary: #2c3e50;
      --text-secondary: #6c7a89;
      --text-inverted: #ffffff;
      --border: #e3e7ed;
      --border-hover: #d0d7de;
      --accent-primary: #3498db;
      --accent-success: #27ae60;
      --accent-warning: #f1c40f;
      --accent-danger: #e74c3c;
      --shadow: rgba(0, 0, 0, 0.05);
      --shadow-hover: rgba(0, 0, 0, 0.08);
    }

    [data-theme="dark"] {
      --bg-primary: #1a1d23;
      --bg-secondary: #2d3748;
      --bg-card: #2a2f3b;
      --bg-control: #3a4252;
      --bg-disabled: #4a2a2a;
      --text-primary: #e2e8f0;
      --text-secondary: #a0aec0;
      --text-inverted: #2d3748;
      --border: #4a5568;
      --border-hover: #718096;
      --accent-primary: #4299e1;
      --accent-success: #48bb78;
      --accent-warning: #ed8936;
      --accent-danger: #f56565;
      --shadow: rgba(0, 0, 0, 0.2);
      --shadow-hover: rgba(0, 0, 0, 0.3);
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      min-height: 100vh;
      color: var(--text-primary);
      line-height: 1.5;
      transition: all 0.3s ease;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: var(--bg-card);
      border-radius: 16px;
      box-shadow: 0 4px 20px var(--shadow);
      transition: all 0.3s ease;
      position: relative;
    }

    h1 {
      margin: 0;
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .subtitle {
      margin-top: 8px;
      font-size: 15px;
      color: var(--text-secondary);
    }

    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: var(--bg-control);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-primary);
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      background: var(--accent-primary);
      color: var(--text-inverted);
      border-color: var(--accent-primary);
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin: 20px 0;
      flex-wrap: wrap;
      align-items: center;
    }

    .control-group,
    .toggle-group {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--bg-control);
      transition: all 0.2s ease;
    }

    .control-group.hidden {
      opacity: 0.4;
      pointer-events: none;
    }

    .control-group label,
    .toggle-label {
      font-weight: 600;
      font-size: 14px;
      color: var(--text-primary);
    }

    .control-group input {
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 15px;
      width: 70px;
      text-align: center;
      transition: border 0.2s;
      background: var(--bg-card);
      color: var(--text-primary);
    }

    .control-group input:focus {
      border-color: var(--accent-primary);
      outline: none;
    }

    .toggle {
      position: relative;
      width: 48px;
      height: 24px;
    }

    .toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--border);
      transition: .3s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
    }

    input:checked+.slider {
      background-color: var(--accent-primary);
    }

    input:checked+.slider:before {
      transform: translateX(24px);
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-reset {
      background: var(--accent-danger);
      color: white;
    }

    .btn-reset:hover {
      background: #c0392b;
    }

    .btn-primary {
      background: var(--accent-primary);
      color: white;
    }

    .btn-primary:hover {
      background: #2980b9;
    }

    .btn-secondary {
      background: var(--bg-control);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--border);
    }

    .warning {
      background: #fff8e1;
      border: 1px solid #ffe082;
      border-radius: 8px;
      padding: 10px;
      margin: 10px auto;
      max-width: 600px;
      text-align: center;
      color: #8d6e63;
      font-size: 14px;
      display: none;
    }

    [data-theme="dark"] .warning {
      background: #5d4037;
      border-color: #8d6e63;
      color: #ffccbc;
    }

    .instructions {
      margin-bottom: 16px;
      padding: 10px 14px;
      border-left: 4px solid var(--accent-primary);
      background: var(--bg-control);
      border-radius: 8px;
      font-size: 14px;
      color: var(--text-primary);
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ */
    .players-management {
      margin-bottom: 20px;
      padding: 16px;
      background: var(--bg-card);
      border-radius: 12px;
      box-shadow: 0 2px 10px var(--shadow);
    }

    .players-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .players-controls {
      display: flex;
      gap: 10px;
    }

    .players-list {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .player-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 8px;
      background: var(--bg-control);
      border: 2px solid transparent;
      transition: all 0.2s;
      cursor: pointer;
      position: relative;
    }

    .player-item.active {
      border-color: var(--accent-primary);
    }

    .player-color {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .player-name {
      font-weight: 600;
      font-size: 14px;
      cursor: text;
      min-width: 100px;
    }

    .player-name-input {
      background: transparent;
      border: none;
      font-weight: 600;
      font-size: 14px;
      color: var(--text-primary);
      width: 100px;
      outline: none;
    }

    .player-count {
      background: var(--accent-primary);
      color: white;
      border-radius: 10px;
      padding: 2px 6px;
      font-size: 12px;
      min-width: 20px;
      text-align: center;
    }

    /* –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–π */
    .categories-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 18px;
      margin-bottom: 24px;
      border-top: 2px dashed var(--accent-primary);
      padding-top: 16px;
    }

    .category {
      background: var(--bg-card);
      border-radius: 12px;
      box-shadow: 0 2px 10px var(--shadow);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .category:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px var(--shadow-hover);
    }

    .category-header {
      background: var(--accent-primary);
      color: var(--text-inverted);
      padding: 10px;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
      border-radius: 12px 12px 0 0;
    }

    .prof-list {
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .prof-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-control);
      cursor: pointer;
      transition: all 0.25s ease;
      opacity: 1;
      position: relative;
      overflow: hidden;
    }

    .prof-item.hidden {
      opacity: 0;
      transform: scale(0.98);
      height: 0;
      margin: 0;
      padding: 0;
      overflow: hidden;
      border: none;
    }

    .prof-item:hover {
      background: var(--bg-primary);
      border-color: var(--border-hover);
    }

    .prof-item.selected {
      border-color: var(--accent-success);
      background: var(--accent-success);
      color: var(--text-inverted);
    }

    .prof-item.disabled {
      opacity: 0.6;
      background: var(--bg-disabled);
      border-color: var(--accent-danger);
      cursor: not-allowed;
    }

    .prof-item.server-prof {
      background: var(--accent-warning);
      border-color: var(--accent-warning);
      color: var(--text-inverted);
    }

    .prof-item.conflict {
      position: relative;
    }

    /* –ò–ó–ú–ï–ù–ï–ù–ò–ï: –£–±–∏—Ä–∞–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–π, –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥—Ä—É–≥–∏–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ */
    .prof-item.other-player-selected {
      border-color: var(--accent-danger);
      background: var(--accent-danger);
      color: var(--text-inverted);
    }

    /* –ò–ó–ú–ï–ù–ï–ù–ò–ï: –£–±–∏—Ä–∞–µ–º –æ–≤–µ—Ä–ª–µ–∏ –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–π, –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥—Ä—É–≥–∏–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ */
    .prof-item.other-player-selected .conflict-overlay,
    .prof-item.other-player-selected .gradient-overlay {
      display: none !important;
    }

    .conflict-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      opacity: 0.3;
    }

    .gradient-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      opacity: 0.4;
    }

    .prof-item-content {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
      position: relative;
      z-index: 2;
    }

    .conflict-indicators {
      display: flex;
      gap: 4px;
      margin-left: auto;
    }

    .conflict-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      position: relative;
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    .conflict-tooltip {
      position: absolute;
      bottom: 100%;
      right: 0;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 12px;
      white-space: nowrap;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      box-shadow: 0 2px 8px var(--shadow);
    }

    .conflict-indicator:hover .conflict-tooltip {
      opacity: 1;
    }

    .day-badge {
      font-weight: 700;
      font-size: 14px;
      min-width: 20px;
      text-align: center;
      position: relative;
      z-index: 2;
      background: rgba(255, 255, 255, 0.9);
      padding: 2px 6px;
      border-radius: 4px;
    }

    [data-theme="dark"] .day-badge {
      background: rgba(0, 0, 0, 0.7);
    }

    .stage-1 {
      color: var(--accent-success);
    }

    .stage-2 {
      color: var(--accent-warning);
    }

    .stage-3 {
      color: var(--accent-danger);
    }

    .prof-item.selected .day-badge {
      color: var(--text-inverted) !important;
      background: rgba(0, 0, 0, 0.3);
    }

    .server-professions {
      background: var(--bg-card);
      border-radius: 12px;
      box-shadow: 0 4px 15px var(--shadow);
      padding: 16px;
      margin-bottom: 20px;
    }

    .server-professions h2 {
      font-size: 18px;
      margin: 0 0 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-primary);
    }

    .server-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .server-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--bg-control);
      transition: all 0.2s;
      color: var(--text-primary);
    }

    .server-item:hover {
      background: var(--bg-primary);
    }

    .server-item.selected {
      border-color: var(--accent-warning);
      font-weight: 600;
      background: var(--accent-warning);
      color: var(--text-inverted);
    }

    .disabled-list {
      margin-top: 20px;
      padding: 16px;
      border: 1px dashed var(--accent-danger);
      border-radius: 12px;
      background: var(--bg-disabled);
    }

    .disabled-list h3 {
      margin: 0 0 10px;
      font-size: 16px;
      color: var(--accent-danger);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .disabled-list ul {
      margin: 0;
      padding-left: 18px;
      columns: 2;
    }

    .disabled-list li {
      margin-bottom: 4px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .counter,
    .server-counter {
      display: inline-block;
      background: var(--accent-danger);
      color: white;
      border-radius: 10px;
      padding: 2px 8px;
      font-size: 13px;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç—É—Ç–æ—Ä–∏–∞–ª–∞ */
    .tutorial-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 10000;
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .tutorial-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .tutorial-modal {
      background: var(--bg-card);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }

    .tutorial-overlay.active .tutorial-modal {
      transform: translateY(0);
    }

    .tutorial-header {
      padding: 20px 24px 0;
      text-align: center;
    }

    .tutorial-title {
      font-size: 24px;
      font-weight: 700;
      margin: 0 0 8px;
      color: var(--text-primary);
    }

    .tutorial-subtitle {
      font-size: 16px;
      color: var(--text-secondary);
      margin-bottom: 16px;
    }

    .tutorial-content {
      padding: 20px 24px;
    }

    .tutorial-step {
      display: none;
    }

    .tutorial-step.active {
      display: block;
    }

    .tutorial-step h3 {
      margin: 0 0 12px;
      font-size: 18px;
      color: var(--accent-primary);
    }

    .tutorial-step p {
      margin: 0 0 16px;
      line-height: 1.6;
    }

    .tutorial-feature {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
      padding: 12px;
      background: var(--bg-control);
      border-radius: 8px;
      border-left: 4px solid var(--accent-primary);
    }

    .tutorial-feature-icon {
      font-size: 20px;
      flex-shrink: 0;
    }

    .tutorial-feature-text {
      flex: 1;
    }

    .tutorial-highlight {
      background: var(--accent-warning);
      color: var(--text-inverted);
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: 600;
    }

    .tutorial-footer {
      padding: 16px 24px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-top: 1px solid var(--border);
    }

    .tutorial-progress {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .tutorial-buttons {
      display: flex;
      gap: 10px;
    }

    .tutorial-skip {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 14px;
      padding: 8px 12px;
      border-radius: 6px;
    }

    .tutorial-skip:hover {
      background: var(--bg-control);
    }

    .tutorial-next {
      background: var(--accent-primary);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }

    .tutorial-next:hover {
      background: #2980b9;
    }

    .tutorial-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: var(--text-secondary);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .tutorial-close:hover {
      background: var(--bg-control);
    }

    .tutorial-highlight-element {
      position: relative;
      z-index: 10001;
      box-shadow: 0 0 0 4px var(--accent-primary) !important;
      border-radius: 8px;
    }

    @media (max-width: 768px) {
      .theme-toggle {
        position: relative;
        top: auto;
        right: auto;
        margin: 10px auto;
        justify-content: center;
      }

      .disabled-list ul {
        columns: 1;
      }

      .players-header {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
      }

      .tutorial-modal {
        width: 95%;
        margin: 10px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏</h1>
      <div class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–∏—Ç–µ –æ—Å–≤–æ–∏—Ç—å. –ö–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –±—É–¥—É—Ç –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å—Å—è.
      </div>
      <button class="theme-toggle" id="themeToggle"><span>üåô</span> –¢—ë–º–Ω–∞—è —Ç–µ–º–∞</button>
      <div class="controls">
        <div class="control-group" id="dayControlGroup">
          <label for="serverDay">–¢–µ–∫—É—â–∏–π –¥–µ–Ω—å —Å–µ—Ä–≤–µ—Ä–∞:</label>
          <input type="number" id="serverDay" min="0" max="100" placeholder="0">
        </div>
        <div class="toggle-group">
          <span class="toggle-label">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏</span>
          <label class="toggle">
            <input type="checkbox" id="showAllToggle">
            <span class="slider"></span>
          </label>
        </div>
        <button class="btn btn-reset" id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä</button>
      </div>
      <div class="warning" id="warningMessage">
        <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –í–∫–ª—é—á–µ–Ω —Ä–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏. –õ–æ–≥–∏–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
        –ø–æ –¥–Ω—é –æ—Ç–∫–ª—é—á–µ–Ω–∞.
      </div>
    </header>

    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ -->
    <div class="players-management">
      <div class="players-header">
        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ <span class="counter" id="playersCount">1</span></h2>
        <div class="players-controls">
          <button class="btn btn-primary" id="addPlayerBtn">+ –î–æ–±–∞–≤–∏—Ç—å</button>
          <button class="btn btn-reset" id="removePlayerBtn">- –£–¥–∞–ª–∏—Ç—å</button>
        </div>
      </div>
      <div class="players-list" id="playersList"></div>
    </div>

    <div class="instructions">
      <strong>–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞:</strong> –í—ã–±–∏—Ä–∞–π—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞. –ö–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏
      –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—é—Ç—Å—è —Ü–≤–µ—Ç–∞–º–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π. –¶–≤–µ—Ç –∑–∞–ª–∏–≤–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —Å –∫–∞–∫–∏–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ –µ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã.
      <strong>–ö–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–µ–∫—É—â–∏–º –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º.</strong>
    </div>
    <div class="categories-container" id="profContainer"></div>

    <div class="server-professions">
      <h2>–ü—Ä–æ—Ñ–µ—Å—Å–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ <span class="server-counter" id="serverCount">0</span></h2>
      <div class="server-list" id="serverList"></div>
      <div style="font-size:13px; color:var(--text-secondary); margin-top:6px;">
        –û—Ç–º–µ—Ç—å—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –µ—Å—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —É—á–µ—Ç–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤).
      </div>
    </div>

    <div class="disabled-list" id="disabledBlock" style="display:none;">
      <h3><span class="counter" id="disabledCount">0</span> –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:</h3>
      <ul id="disabledList"></ul>
    </div>
  </div>

  <!-- –¢—É—Ç–æ—Ä–∏–∞–ª -->
  <div class="tutorial-overlay" id="tutorialOverlay">
    <div class="tutorial-modal">
      <button class="tutorial-close" id="tutorialClose">√ó</button>
      <div class="tutorial-header">
        <h2 class="tutorial-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–π!</h2>
        <div class="tutorial-subtitle">–î–∞–≤–∞–π—Ç–µ –ø–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏</div>
      </div>
      <div class="tutorial-content">
        <div class="tutorial-step active" id="step1">
          <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è</h3>
          <p>–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–π –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, –∏–∑–±–µ–≥–∞—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
            –º–µ–∂–¥—É –Ω–∏–º–∏.</p>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">üéØ</div>
            <div class="tutorial-feature-text">
              <strong>–ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–π</strong> - –∫–æ–≥–¥–∞ –æ–¥–Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏—è –º–µ—à–∞–µ—Ç –æ—Å–≤–æ–∏—Ç—å –¥—Ä—É–≥—É—é
            </div>
          </div>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">üë•</div>
            <div class="tutorial-feature-text">
              <strong>–ú—É–ª—å—Ç–∏–ø–µ—Ä—Å–æ–Ω–∞–∂–Ω–æ—Å—Ç—å</strong> - —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
            </div>
          </div>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">üìÖ</div>
            <div class="tutorial-feature-text">
              <strong>–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–Ω—è–º</strong> - –ø–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏
            </div>
          </div>
        </div>

        <div class="tutorial-step" id="step2">
          <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏</h3>
          <p>–í—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏. –ö–∞–∂–¥—ã–π –∏–º–µ–µ—Ç —Å–≤–æ–π —Ü–≤–µ—Ç –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–ª–∏—á–∏—è.</p>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">‚ûï</div>
            <div class="tutorial-feature-text">
              <strong>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</strong> - —á—Ç–æ–±—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –¥–ª—è –¥—Ä—É–≥–æ–≥–æ –≥–µ—Ä–æ—è
            </div>
          </div>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">‚úèÔ∏è</div>
            <div class="tutorial-feature-text">
              <strong>–î–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –∏–º–µ–Ω–∏</strong> - —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –µ–≥–æ
            </div>
          </div>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">üé®</div>
            <div class="tutorial-feature-text">
              <strong>–¶–≤–µ—Ç–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã</strong> - –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, –∫–æ–º—É –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏
            </div>
          </div>
        </div>

        <div class="tutorial-step" id="step3">
          <h3>–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–Ω—è–º —Å–µ—Ä–≤–µ—Ä–∞</h3>
          <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –¥–Ω–∏. –í—ã –º–æ–∂–µ—Ç–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏—Ö –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.</p>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">üìÖ</div>
            <div class="tutorial-feature-text">
              <strong>–£–∫–∞–∂–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å —Å–µ—Ä–≤–µ—Ä–∞</strong> - —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏
            </div>
          </div>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">üî¢</div>
            <div class="tutorial-feature-text">
              <strong>–¶–∏—Ñ—Ä—ã –Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏—è—Ö</strong> - –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –¥–µ–Ω—å, –∫–æ–≥–¥–∞ –æ–Ω–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è
            </div>
          </div>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">üåà</div>
            <div class="tutorial-feature-text">
              <strong>–¶–≤–µ—Ç–∞ —Ü–∏—Ñ—Ä</strong> - –∑–µ–ª–µ–Ω—ã–µ (—Ä–∞–Ω–Ω–∏–µ), –∂–µ–ª—Ç—ã–µ (—Å—Ä–µ–¥–Ω–∏–µ), –∫—Ä–∞—Å–Ω—ã–µ (–ø–æ–∑–¥–Ω–∏–µ)
            </div>
          </div>
        </div>

        <div class="tutorial-step" id="step4">
          <h3>–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏</h3>
          <p>–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∏—Ö –≤—ã–±–æ—Ä.</p>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">üö´</div>
            <div class="tutorial-feature-text">
              <strong>–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏</strong> - –≤—ã–¥–µ–ª—è—é—Ç—Å—è –∫—Ä–∞—Å–Ω—ã–º –∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω—ã
            </div>
          </div>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">üé®</div>
            <div class="tutorial-feature-text">
              <strong>–¶–≤–µ—Ç–Ω—ã–µ –æ–≤–µ—Ä–ª–µ–∏</strong> - –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —Å –∫–∞–∫–∏–º –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç
            </div>
          </div>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">üìã</div>
            <div class="tutorial-feature-text">
              <strong>–°–ø–∏—Å–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö</strong> - –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫
            </div>
          </div>
        </div>

        <div class="tutorial-step" id="step5">
          <h3>–°–µ—Ä–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏</h3>
          <p>–û—Ç–º–µ—á–∞–π—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –µ—Å—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∏—Ö –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞.</p>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">‚úÖ</div>
            <div class="tutorial-feature-text">
              <strong>–û—Ç–º–µ—Ç—å—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ</strong> - –æ–Ω–∏ —Å—Ç–∞–Ω—É—Ç –∂–µ–ª—Ç—ã–º–∏ –∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞
            </div>
          </div>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">üîÑ</div>
            <div class="tutorial-feature-text">
              <strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —É—á–µ—Ç</strong> - —Å–∏—Å—Ç–µ–º–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç –∏—Ö –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
            </div>
          </div>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">üëÄ</div>
            <div class="tutorial-feature-text">
              <strong>–ë—ã—Å—Ç—Ä—ã–π –æ–±–∑–æ—Ä</strong> - —Å—á—ë—Ç—á–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–π —É–∂–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
            </div>
          </div>
        </div>

        <div class="tutorial-step" id="step6">
          <h3>–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å!</h3>
          <p>–¢–µ–ø–µ—Ä—å –≤—ã –∑–Ω–∞–µ—Ç–µ –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–π.</p>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">üí°</div>
            <div class="tutorial-feature-text">
              <strong>–°–æ–≤–µ—Ç:</strong> –ù–∞—á–Ω–∏—Ç–µ —Å –≤–≤–æ–¥–∞ —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è —Å–µ—Ä–≤–µ—Ä–∞
            </div>
          </div>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">üí°</div>
            <div class="tutorial-feature-text">
              <strong>–°–æ–≤–µ—Ç:</strong> –û—Ç–º–µ—Ç—å—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –µ—Å—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
            </div>
          </div>
          <div class="tutorial-feature">
            <div class="tutorial-feature-icon">üí°</div>
            <div class="tutorial-feature-text">
              <strong>–°–æ–≤–µ—Ç:</strong> –î–æ–±–∞–≤—å—Ç–µ –≤—Å–µ—Ö —Å–≤–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –ø–µ—Ä–µ–¥ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
            </div>
          </div>
          <p style="margin-top: 16px; text-align: center; font-weight: 600; color: var(--accent-primary);">
            –ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è! üéÆ
          </p>
        </div>
      </div>
      <div class="tutorial-footer">
        <div class="tutorial-progress" id="tutorialProgress">–®–∞–≥ 1 –∏–∑ 6</div>
        <div class="tutorial-buttons">
          <button class="tutorial-skip" id="tutorialSkip">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
          <button class="tutorial-next" id="tutorialNext">–î–∞–ª–µ–µ</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== –î–∞–Ω–Ω—ã–µ ======
    const categories = {
      "–û—Ö–æ—Ç–∞ –∏ —Ä–∞–∑–¥–µ–ª–∫–∞": ["–æ—Ö–æ—Ç–∞", "—Ä–∞–∑–¥–µ–ª–∫–∞"],
      "–§–µ—Ä–º–µ—Ä—Å—Ç–≤–æ": ["—É–¥–æ–±—Ä–µ–Ω–∏—è", "–ú–µ–ª—å–Ω–∏–∫", "—Å–æ–±–∏—Ä–∞—à–∫–∞", "—Ñ–µ—Ä–º–µ—Ä"],
      "–¢–µ—Ö–Ω–∏–∫–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ": ["–º–µ—Ö", "–ò–Ω–∂–∞", "–ø—Ä–æ–º–∫–∞", "–≠–ª–µ–∫—Ç—Ä–æ"],
      "–ì–æ—Ä–Ω—è–∫": ["–ì–æ–Ω—á–∞—Ä", "–ì–æ—Ä–Ω—è–∫", "–ö–∞–º–µ–Ω–∫–∞", "–°—Ç–µ–∫–ª–æ", "–ü—Ä–æ–¥ –∫–∞–º–µ–Ω–∫–∞"],
      "–ú–µ—Ç–∞–ª–ª—É—Ä–≥–∏—è": ["–≤—ã–ø–ª–∞–≤–∫–∞", "–∫–æ–≤–∫–∞", "–ü—Ä–æ–¥ –≤—ã–ø–ª–∞–≤–∫–∞"],
      "–õ–µ—Å–æ—Ä—É–±": ["–ó–∞–≥–æ—Ç–æ–≤–∫–∞", "–ö–æ—Ä–∞–±–µ–ª", "–ü–ª–æ—Ç–Ω–∏–∫", "–ë—É–º–∞–≥–∞", "–ö–æ–º–ø–æ–∑–∏—Ç—ã"],
      "–ö—É–ª–∏–Ω–∞—Ä–∏—è": ["–≤—ã–ø–µ—á–∫–∞", "–ì–æ—Ç–æ–≤–∫–∞", "–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞ –∫–æ—Å—Ç—Ä–µ", "–ü–µ—Ä–µ–¥–æ–≤–∞—è –∫—É–ª–∏–Ω–∞—Ä–∫–∞", "–ø—Ä–æ–¥ –≤—ã–ø–µ—á–∫–∞", "–ø—Ä–æ–¥ –∫—É–ª–∏–Ω–∞—Ä–∏—è"],
      "–ü–æ—Ä—Ç–Ω—è–∂–Ω–æ–µ –¥–µ–ª–æ": ["–¢–∫–∞–Ω—å"],
      "–ù–µ—Ñ—Ç–µ–¥–æ–±—ã—á–∞ –∏ –ø–æ–∫—Ä–∞—Å–∫–∞": ["–Ω–µ—Ñ—Ç—å", "–ú–∞–ª—è—Ä"]
    };

    // ======= –ö–û–ù–§–õ–ò–ö–¢–´ (–∏–∑ Excel) =======
    const conflicts = {
      "–ü–ª–æ—Ç–Ω–∏–∫": ["–ó–∞–≥–æ—Ç–æ–≤–∫–∞", "–ú–µ–ª—å–Ω–∏–∫", "–°—Ç–µ–∫–ª–æ", "–≤—ã–ø–ª–∞–≤–∫–∞"],
      "–ö–æ–º–ø–æ–∑–∏—Ç—ã": ["–ó–∞–≥–æ—Ç–æ–≤–∫–∞", "–≠–ª–µ–∫—Ç—Ä–æ", "–º–µ—Ö", "–Ω–µ—Ñ—Ç—å"],
      "–ö–æ—Ä–∞–±–µ–ª": ["–ó–∞–≥–æ—Ç–æ–≤–∫–∞", "–ø—Ä–æ–º–∫–∞", "–º–µ—Ö", "–ü—Ä–æ–¥ –≤—ã–ø–ª–∞–≤–∫–∞", "–≤—ã–ø–ª–∞–≤–∫–∞"],
      "–ó–∞–≥–æ—Ç–æ–≤–∫–∞": ["–ü–ª–æ—Ç–Ω–∏–∫", "–ö–æ–º–ø–æ–∑–∏—Ç—ã", "–ö–æ—Ä–∞–±–µ–ª", "–ë—É–º–∞–≥–∞", "–ò–Ω–∂–∞", "—É–¥–æ–±—Ä–µ–Ω–∏—è", "–ì–æ–Ω—á–∞—Ä", "–∫–æ–≤–∫–∞", "–¢–∫–∞–Ω—å"],
      "–ë—É–º–∞–≥–∞": ["–ó–∞–≥–æ—Ç–æ–≤–∫–∞", "–ú–∞–ª—è—Ä", "–°—Ç–µ–∫–ª–æ", "–¢–∫–∞–Ω—å"],
      "–ø—Ä–æ–¥ –≤—ã–ø–µ—á–∫–∞": ["–ø—Ä–æ–¥ –∫—É–ª–∏–Ω–∞—Ä–∏—è", "–≥–æ—Ç–æ–≤–∫–∞", "—Ñ–µ—Ä–º–µ—Ä", "—Å–æ–±–∏—Ä–∞—à–∫–∞", "–ú–µ–ª—å–Ω–∏–∫", "—Ä–∞–∑–¥–µ–ª–∫–∞"],
      "–ø—Ä–æ–¥ –∫—É–ª–∏–Ω–∞—Ä–∏—è": ["–ø—Ä–æ–¥ –≤—ã–ø–µ—á–∫–∞", "–≤—ã–ø–µ—á–∫–∞", "—Ñ–µ—Ä–º–µ—Ä", "—Å–æ–±–∏—Ä–∞—à–∫–∞", "–ú–µ–ª—å–Ω–∏–∫", "—Ä–∞–∑–¥–µ–ª–∫–∞"],
      "–≤—ã–ø–µ—á–∫–∞": ["–ø—Ä–æ–¥ –∫—É–ª–∏–Ω–∞—Ä–∏—è", "–≥–æ—Ç–æ–≤–∫–∞", "—Ñ–µ—Ä–º–µ—Ä", "—Å–æ–±–∏—Ä–∞—à–∫–∞", "–ú–µ–ª—å–Ω–∏–∫", "—Ä–∞–∑–¥–µ–ª–∫–∞"],
      "–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞ –∫–æ—Å—Ç—Ä–µ": ["—Ñ–µ—Ä–º–µ—Ä", "—Å–æ–±–∏—Ä–∞—à–∫–∞", "–ú–µ–ª—å–Ω–∏–∫", "—Ä–∞–∑–¥–µ–ª–∫–∞", "–æ—Ö–æ—Ç–∞"],
      "–ì–æ—Ç–æ–≤–∫–∞": ["–ø—Ä–æ–¥ –≤—ã–ø–µ—á–∫–∞", "–≤—ã–ø–µ—á–∫–∞", "—Ñ–µ—Ä–º–µ—Ä", "—Å–æ–±–∏—Ä–∞—à–∫–∞", "–ú–µ–ª—å–Ω–∏–∫", "—Ä–∞–∑–¥–µ–ª–∫–∞"],
      "–ü–µ—Ä–µ–¥–æ–≤–∞—è –∫—É–ª–∏–Ω–∞—Ä–∫–∞": ["–Ω–µ—Ñ—Ç—å", "—Ñ–µ—Ä–º–µ—Ä", "—Å–æ–±–∏—Ä–∞—à–∫–∞", "–ú–µ–ª—å–Ω–∏–∫", "—Ä–∞–∑–¥–µ–ª–∫–∞", "–æ—Ö–æ—Ç–∞"],
      "–ò–Ω–∂–∞": ["–ó–∞–≥–æ—Ç–æ–≤–∫–∞", "–ö–∞–º–µ–Ω–∫–∞", "–ì–æ—Ä–Ω—è–∫", "–≤—ã–ø–ª–∞–≤–∫–∞", "–¢–∫–∞–Ω—å"],
      "–≠–ª–µ–∫—Ç—Ä–æ": ["–ö–æ–º–ø–æ–∑–∏—Ç—ã", "–ø—Ä–æ–º–∫–∞", "–º–µ—Ö", "–Ω–µ—Ñ—Ç—å", "–ü—Ä–æ–¥ –≤—ã–ø–ª–∞–≤–∫–∞", "–≤—ã–ø–ª–∞–≤–∫–∞"],
      "–ø—Ä–æ–º–∫–∞": ["–ö–æ—Ä–∞–±–µ–ª", "–≠–ª–µ–∫—Ç—Ä–æ", "–º–µ—Ö", "–Ω–µ—Ñ—Ç—å", "–ü—Ä–æ–¥ –≤—ã–ø–ª–∞–≤–∫–∞", "–≤—ã–ø–ª–∞–≤–∫–∞"],
      "–º–µ—Ö": ["–ö–æ–º–ø–æ–∑–∏—Ç—ã", "–ö–æ—Ä–∞–±–µ–ª", "–≠–ª–µ–∫—Ç—Ä–æ", "–ø—Ä–æ–º–∫–∞", "—Ä–∞–∑–¥–µ–ª–∫–∞", "–°—Ç–µ–∫–ª–æ", "–ü—Ä–æ–¥ –≤—ã–ø–ª–∞–≤–∫–∞", "–∫–æ–≤–∫–∞", "–≤—ã–ø–ª–∞–≤–∫–∞"],
      "–ú–∞–ª—è—Ä": ["–ë—É–º–∞–≥–∞", "–Ω–µ—Ñ—Ç—å", "–ú–µ–ª—å–Ω–∏–∫", "–°—Ç–µ–∫–ª–æ", "–ì–æ–Ω—á–∞—Ä", "–≤—ã–ø–ª–∞–≤–∫–∞", "–¢–∫–∞–Ω—å"],
      "–Ω–µ—Ñ—Ç—å": ["–ö–æ–º–ø–æ–∑–∏—Ç—ã", "–ü–µ—Ä–µ–¥–æ–≤–∞—è –∫—É–ª–∏–Ω–∞—Ä–∫–∞", "–≠–ª–µ–∫—Ç—Ä–æ", "–ø—Ä–æ–º–∫–∞", "–ú–∞–ª—è—Ä", "—Ä–∞–∑–¥–µ–ª–∫–∞", "–°—Ç–µ–∫–ª–æ", "–ü—Ä–æ–¥ –≤—ã–ø–ª–∞–≤–∫–∞", "–∫–æ–≤–∫–∞", "–≤—ã–ø–ª–∞–≤–∫–∞"],
      "—Ñ–µ—Ä–º–µ—Ä": ["–ø—Ä–æ–¥ –≤—ã–ø–µ—á–∫–∞", "–ø—Ä–æ–¥ –∫—É–ª–∏–Ω–∞—Ä–∏—è", "–≤—ã–ø–µ—á–∫–∞", "–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞ –∫–æ—Å—Ç—Ä–µ", "–≥–æ—Ç–æ–≤–∫–∞", "—É–¥–æ–±—Ä–µ–Ω–∏—è", "–ú–µ–ª—å–Ω–∏–∫", "–≤—ã–ø–ª–∞–≤–∫–∞", "–¢–∫–∞–Ω—å"],
      "—É–¥–æ–±—Ä–µ–Ω–∏—è": ["–ó–∞–≥–æ—Ç–æ–≤–∫–∞", "—Ñ–µ—Ä–º–µ—Ä", "—Å–æ–±–∏—Ä–∞—à–∫–∞", "—Ä–∞–∑–¥–µ–ª–∫–∞"],
      "—Å–æ–±–∏—Ä–∞—à–∫–∞": ["–ø—Ä–æ–¥ –≤—ã–ø–µ—á–∫–∞", "–ø—Ä–æ–¥ –∫—É–ª–∏–Ω–∞—Ä–∏—è", "–≤—ã–ø–µ—á–∫–∞", "–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞ –∫–æ—Å—Ç—Ä–µ", "–≥–æ—Ç–æ–≤–∫–∞", "—É–¥–æ–±—Ä–µ–Ω–∏—è", "–ú–µ–ª—å–Ω–∏–∫", "–≤—ã–ø–ª–∞–≤–∫–∞", "–¢–∫–∞–Ω—å"],
      "–ú–µ–ª—å–Ω–∏–∫": ["–ü–ª–æ—Ç–Ω–∏–∫", "–ø—Ä–æ–¥ –≤—ã–ø–µ—á–∫–∞", "–ø—Ä–æ–¥ –∫—É–ª–∏–Ω–∞—Ä–∏—è", "–≤—ã–ø–µ—á–∫–∞", "–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞ –∫–æ—Å—Ç—Ä–µ", "–≥–æ—Ç–æ–≤–∫–∞", "–ú–∞–ª—è—Ä", "—Ñ–µ—Ä–º–µ—Ä", "—Å–æ–±–∏—Ä–∞—à–∫–∞"],
      "—Ä–∞–∑–¥–µ–ª–∫–∞": ["–ø—Ä–æ–¥ –≤—ã–ø–µ—á–∫–∞", "–ø—Ä–æ–¥ –∫—É–ª–∏–Ω–∞—Ä–∏—è", "–≤—ã–ø–µ—á–∫–∞", "–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞ –∫–æ—Å—Ç—Ä–µ", "–≥–æ—Ç–æ–≤–∫–∞", "–Ω–µ—Ñ—Ç—å", "—É–¥–æ–±—Ä–µ–Ω–∏—è", "–æ—Ö–æ—Ç–∞", "–∫–æ–≤–∫–∞", "–¢–∫–∞–Ω—å"],
      "–æ—Ö–æ—Ç–∞": ["–≤—ã–ø–µ—á–∫–∞", "–ì–æ—Ç–æ–≤–∫–∞", "—Ä–∞–∑–¥–µ–ª–∫–∞"],
      "–ü—Ä–æ–¥ –∫–∞–º–µ–Ω–∫–∞": ["–ì–æ—Ä–Ω—è–∫", "–ü—Ä–æ–¥ –≤—ã–ø–ª–∞–≤–∫–∞"],
      "–°—Ç–µ–∫–ª–æ": ["–ü–ª–æ—Ç–Ω–∏–∫", "–ë—É–º–∞–≥–∞", "–º–µ—Ö", "–ú–∞–ª—è—Ä", "–Ω–µ—Ñ—Ç—å", "–ì–æ—Ä–Ω—è–∫", "–ü—Ä–æ–¥ –≤—ã–ø–ª–∞–≤–∫–∞", "–∫–æ–≤–∫–∞"],
      "–ö–∞–º–µ–Ω–∫–∞": ["–ò–Ω–∂–∞", "–ì–æ—Ä–Ω—è–∫", "–ì–æ–Ω—á–∞—Ä"],
      "–ì–æ—Ä–Ω—è–∫": ["–ò–Ω–∂–∞", "–ü—Ä–æ–¥ –∫–∞–º–µ–Ω–∫–∞", "–°—Ç–µ–∫–ª–æ", "–ö–∞–º–µ–Ω–∫–∞", "–ì–æ–Ω—á–∞—Ä", "–ü—Ä–æ–¥ –≤—ã–ø–ª–∞–≤–∫–∞", "–≤—ã–ø–ª–∞–≤–∫–∞"],
      "–ì–æ–Ω—á–∞—Ä": ["–ó–∞–≥–æ—Ç–æ–≤–∫–∞", "–ú–∞–ª—è—Ä", "–ö–∞–º–µ–Ω–∫–∞", "–ì–æ—Ä–Ω—è–∫", "–ü—Ä–æ–¥ –≤—ã–ø–ª–∞–≤–∫–∞", "–∫–æ–≤–∫–∞", "–≤—ã–ø–ª–∞–≤–∫–∞"],
      "–ü—Ä–æ–¥ –≤—ã–ø–ª–∞–≤–∫–∞": ["–ö–æ—Ä–∞–±–µ–ª", "–≠–ª–µ–∫—Ç—Ä–æ", "–ø—Ä–æ–º–∫–∞", "–º–µ—Ö", "–Ω–µ—Ñ—Ç—å", "–ü—Ä–æ–¥ –∫–∞–º–µ–Ω–∫–∞", "–°—Ç–µ–∫–ª–æ", "–ì–æ—Ä–Ω—è–∫", "–ì–æ–Ω—á–∞—Ä", "–∫–æ–≤–∫–∞", "–≤—ã–ø–ª–∞–≤–∫–∞"],
      "–∫–æ–≤–∫–∞": ["–ó–∞–≥–æ—Ç–æ–≤–∫–∞", "–º–µ—Ö", "–Ω–µ—Ñ—Ç—å", "—Ä–∞–∑–¥–µ–ª–∫–∞", "–°—Ç–µ–∫–ª–æ", "–ì–æ–Ω—á–∞—Ä", "–ü—Ä–æ–¥ –≤—ã–ø–ª–∞–≤–∫–∞", "–≤—ã–ø–ª–∞–≤–∫–∞"],
      "–≤—ã–ø–ª–∞–≤–∫–∞": ["–ü–ª–æ—Ç–Ω–∏–∫", "–ö–æ—Ä–∞–±–µ–ª", "–ò–Ω–∂–∞", "–≠–ª–µ–∫—Ç—Ä–æ", "–ø—Ä–æ–º–∫–∞", "–º–µ—Ö", "–ú–∞–ª—è—Ä", "–Ω–µ—Ñ—Ç—å", "—Ñ–µ—Ä–º–µ—Ä", "—Å–æ–±–∏—Ä–∞—à–∫–∞", "–ì–æ—Ä–Ω—è–∫", "–ì–æ–Ω—á–∞—Ä", "–ü—Ä–æ–¥ –≤—ã–ø–ª–∞–≤–∫–∞", "–∫–æ–≤–∫–∞"],
      "–¢–∫–∞–Ω—å": ["–ó–∞–≥–æ—Ç–æ–≤–∫–∞", "–ë—É–º–∞–≥–∞", "–ò–Ω–∂–∞", "–ú–∞–ª—è—Ä", "—Ñ–µ—Ä–º–µ—Ä", "—Å–æ–±–∏—Ä–∞—à–∫–∞", "—Ä–∞–∑–¥–µ–ª–∫–∞"]
    };

    // –î–∞–Ω–Ω—ã–µ –æ –¥–Ω—è—Ö –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–π (–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ)
    const professionDays = {
      "–æ—Ö–æ—Ç–∞": 0,
      "—Ä–∞–∑–¥–µ–ª–∫–∞": 1,
      "—É–¥–æ–±—Ä–µ–Ω–∏—è": 5,
      "–ú–µ–ª—å–Ω–∏–∫": 5,
      "—Å–æ–±–∏—Ä–∞—à–∫–∞": 0,
      "—Ñ–µ—Ä–º–µ—Ä": 1,
      "–º–µ—Ö": 3,
      "–ò–Ω–∂–∞": 5,
      "–ø—Ä–æ–º–∫–∞": 15,
      "–≠–ª–µ–∫—Ç—Ä–æ": 15,
      "–ì–æ–Ω—á–∞—Ä": 5,
      "–ì–æ—Ä–Ω—è–∫": 0,
      "–ö–∞–º–µ–Ω–∫–∞": 1,
      "–°—Ç–µ–∫–ª–æ": 5,
      "–ü—Ä–æ–¥ –∫–∞–º–µ–Ω–∫–∞": 15,
      "–≤—ã–ø–ª–∞–≤–∫–∞": 3,
      "–∫–æ–≤–∫–∞": 3,
      "–ü—Ä–æ–¥ –≤—ã–ø–ª–∞–≤–∫–∞": 15,
      "–ó–∞–≥–æ—Ç–æ–≤–∫–∞": 0,
      "–ö–æ—Ä–∞–±–µ–ª": 1,
      "–ü–ª–æ—Ç–Ω–∏–∫": 1,
      "–ë—É–º–∞–≥–∞": 5,
      "–ö–æ–º–ø–æ–∑–∏—Ç—ã": 15,
      "–≤—ã–ø–µ—á–∫–∞": 5,
      "–ì–æ—Ç–æ–≤–∫–∞": 5,
      "–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞ –∫–æ—Å—Ç—Ä–µ": 0,
      "–ü–µ—Ä–µ–¥–æ–≤–∞—è –∫—É–ª–∏–Ω–∞—Ä–∫–∞": 15,
      "–ø—Ä–æ–¥ –≤—ã–ø–µ—á–∫–∞": 15,
      "–ø—Ä–æ–¥ –∫—É–ª–∏–Ω–∞—Ä–∏—è": 15,
      "–¢–∫–∞–Ω—å": 1,
      "–Ω–µ—Ñ—Ç—å": 15,
      "–ú–∞–ª—è—Ä": 5
    };

    // –¶–≤–µ—Ç–∞ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
    const playerColors = [
      "#3498db", "#e74c3c", "#2ecc71", "#f39c12",
      "#9b59b6", "#1abc9c", "#d35400", "#34495e"
    ];

    // ====== –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ======
    const container = document.getElementById("profContainer");
    const serverList = document.getElementById("serverList");
    const serverCount = document.getElementById("serverCount");
    const disabledBlock = document.getElementById("disabledBlock");
    const disabledList = document.getElementById("disabledList");
    const disabledCount = document.getElementById("disabledCount");
    const serverDayInput = document.getElementById("serverDay");
    const showAllToggle = document.getElementById("showAllToggle");
    const resetBtn = document.getElementById("resetBtn");
    const warningMessage = document.getElementById("warningMessage");
    const dayControlGroup = document.getElementById("dayControlGroup");
    const themeToggle = document.getElementById("themeToggle");
    const playersList = document.getElementById("playersList");
    const playersCount = document.getElementById("playersCount");
    const addPlayerBtn = document.getElementById("addPlayerBtn");
    const removePlayerBtn = document.getElementById("removePlayerBtn");

    // –≠–ª–µ–º–µ–Ω—Ç—ã —Ç—É—Ç–æ—Ä–∏–∞–ª–∞
    const tutorialOverlay = document.getElementById("tutorialOverlay");
    const tutorialClose = document.getElementById("tutorialClose");
    const tutorialSkip = document.getElementById("tutorialSkip");
    const tutorialNext = document.getElementById("tutorialNext");
    const tutorialProgress = document.getElementById("tutorialProgress");

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    let players = [
      { id: 1, name: "–ü–µ—Ä—Å–æ–Ω–∞–∂ 1", color: playerColors[0], professions: [] }
    ];
    let activePlayerId = 1;

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç—É—Ç–æ—Ä–∏–∞–ª–∞
    let currentTutorialStep = 1;
    const totalTutorialSteps = 6;

    // ====== –§—É–Ω–∫—Ü–∏–∏ —Ç—É—Ç–æ—Ä–∏–∞–ª–∞ ======
    function showTutorial() {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–∫–∞–∑—ã–≤–∞–ª—Å—è –ª–∏ —É–∂–µ —Ç—É—Ç–æ—Ä–∏–∞–ª
      const tutorialShown = localStorage.getItem('tutorialShown');
      if (tutorialShown) return;

      tutorialOverlay.classList.add('active');
      updateTutorialStep();
    }

    function hideTutorial() {
      tutorialOverlay.classList.remove('active');
      localStorage.setItem('tutorialShown', 'true');
    }

    function nextTutorialStep() {
      if (currentTutorialStep < totalTutorialSteps) {
        currentTutorialStep++;
        updateTutorialStep();
      } else {
        hideTutorial();
      }
    }

    function updateTutorialStep() {
      // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —à–∞–≥–∏
      document.querySelectorAll('.tutorial-step').forEach(step => {
        step.classList.remove('active');
      });

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —à–∞–≥
      const currentStep = document.getElementById(`step${currentTutorialStep}`);
      if (currentStep) {
        currentStep.classList.add('active');
      }

      // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
      tutorialProgress.textContent = `–®–∞–≥ ${currentTutorialStep} –∏–∑ ${totalTutorialSteps}`;

      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º —à–∞–≥–µ
      if (currentTutorialStep === totalTutorialSteps) {
        tutorialNext.textContent = '–ó–∞–≤–µ—Ä—à–∏—Ç—å';
      } else {
        tutorialNext.textContent = '–î–∞–ª–µ–µ';
      }

      // –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —à–∞–≥–∞—Ö
      if (currentTutorialStep === 3) {
        // –ù–∞ —à–∞–≥–µ 3 –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –¥–Ω—è–º
        serverDayInput.value = "5";
        setTimeout(() => {
          refreshProfessions();
        }, 300);
      } else if (currentTutorialStep === 4) {
        // –ù–∞ —à–∞–≥–µ 4 –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
        serverDayInput.value = "";
        setTimeout(() => {
          refreshProfessions();
        }, 300);
      }
    }

    function setupTutorialEventListeners() {
      tutorialClose.addEventListener('click', hideTutorial);
      tutorialSkip.addEventListener('click', hideTutorial);
      tutorialNext.addEventListener('click', nextTutorialStep);

      // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      tutorialOverlay.addEventListener('click', (e) => {
        if (e.target === tutorialOverlay) {
          hideTutorial();
        }
      });
    }

    // ====== –§—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ ======
    function saveState() {
      const state = {
        serverSelections: Array.from(serverList.querySelectorAll("input[type='checkbox']:checked")).map(cb => cb.value),
        serverDay: serverDayInput.value.trim(),
        showAll: showAllToggle.checked,
        theme: document.body.getAttribute('data-theme') || 'light',
        players: players,
        activePlayerId: activePlayerId
      };

      localStorage.setItem('professionsState', JSON.stringify(state));
    }

    function loadState() {
      const saved = localStorage.getItem('professionsState');
      if (!saved) return;

      const state = JSON.parse(saved);

      if (state.serverDay !== undefined) serverDayInput.value = state.serverDay;
      if (state.showAll !== undefined) showAllToggle.checked = state.showAll;
      if (state.theme) {
        document.body.setAttribute('data-theme', state.theme);
      }
      if (state.players) players = state.players;
      if (state.activePlayerId) activePlayerId = state.activePlayerId;

      updateThemeButton();
      renderPlayers();

      setTimeout(() => {
        if (state.serverSelections) {
          serverList.querySelectorAll("input[type='checkbox']").forEach(cb => {
            cb.checked = state.serverSelections.includes(cb.value);
          });
        }

        refreshProfessions();
      }, 0);
    }

    // ====== –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ ======
    function renderPlayers() {
      playersList.innerHTML = "";
      playersCount.textContent = players.length;

      players.forEach(player => {
        const playerItem = document.createElement("div");
        playerItem.className = `player-item ${player.id === activePlayerId ? 'active' : ''}`;
        playerItem.dataset.playerId = player.id;

        const colorDiv = document.createElement("div");
        colorDiv.className = "player-color";
        colorDiv.style.backgroundColor = player.color;

        const nameSpan = document.createElement("span");
        nameSpan.className = "player-name";
        nameSpan.textContent = player.name;

        // –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–µ–Ω–∏
        nameSpan.addEventListener('dblclick', () => {
          const input = document.createElement('input');
          input.type = 'text';
          input.className = 'player-name-input';
          input.value = player.name;
          input.maxLength = 20;

          input.addEventListener('blur', () => {
            player.name = input.value.trim() || `–ü–µ—Ä—Å–æ–Ω–∞–∂ ${player.id}`;
            renderPlayers();
            saveState();
          });

          input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
              input.blur();
            }
          });

          nameSpan.replaceWith(input);
          input.focus();
          input.select();
        });

        const countSpan = document.createElement("span");
        countSpan.className = "player-count";
        countSpan.textContent = player.professions.length;

        playerItem.appendChild(colorDiv);
        playerItem.appendChild(nameSpan);
        playerItem.appendChild(countSpan);

        playerItem.addEventListener("click", (e) => {
          if (!e.target.classList.contains('player-name-input')) {
            setActivePlayer(player.id);
          }
        });

        playersList.appendChild(playerItem);
      });

      removePlayerBtn.disabled = players.length <= 1;
    }

    function setActivePlayer(playerId) {
      activePlayerId = playerId;

      playersList.querySelectorAll(".player-item").forEach(item => {
        item.classList.toggle("active", parseInt(item.dataset.playerId) === playerId);
      });

      updateProfessionsSelection();
      refreshProfessions();
      saveState();
    }

    function addPlayer() {
      if (players.length >= 8) return;

      const newId = players.length > 0 ? Math.max(...players.map(p => p.id)) + 1 : 1;
      const newPlayer = {
        id: newId,
        name: `–ü–µ—Ä—Å–æ–Ω–∞–∂ ${newId}`,
        color: playerColors[(newId - 1) % playerColors.length],
        professions: []
      };

      players.push(newPlayer);
      renderPlayers();
      setActivePlayer(newId);
    }

    function removePlayer() {
      if (players.length <= 1) return;

      const playerIndex = players.findIndex(p => p.id === activePlayerId);
      players.splice(playerIndex, 1);

      if (players.length > 0) {
        setActivePlayer(players[0].id);
      }

      renderPlayers();
    }

    function updateProfessionsSelection() {
      const activePlayer = players.find(p => p.id === activePlayerId);
      if (!activePlayer) return;

      container.querySelectorAll("input[type='checkbox']").forEach(cb => {
        cb.checked = activePlayer.professions.includes(cb.value);
      });
    }

    // ====== –†–µ–Ω–¥–µ—Ä –ø—Ä–æ—Ñ–µ—Å—Å–∏–π ======
    function createDayBadge(prof) {
      const day = professionDays[prof] || 0;
      const stage = day <= 4 ? 1 : day <= 14 ? 2 : 3;
      const badge = document.createElement("span");
      badge.className = `day-badge stage-${stage}`;
      badge.textContent = day;
      badge.title = `–î–µ–Ω—å –æ—Ç–∫—Ä—ã—Ç–∏—è: ${day}`;
      return badge;
    }

    function renderMainProfessions() {
      container.innerHTML = "";
      for (const [catName, profs] of Object.entries(categories)) {
        const catDiv = document.createElement("div");
        catDiv.className = "category";

        const header = document.createElement("div");
        header.className = "category-header";
        header.textContent = catName;
        catDiv.appendChild(header);

        const listDiv = document.createElement("div");
        listDiv.className = "prof-list";

        profs.forEach(prof => {
          const label = document.createElement("label");
          label.className = "prof-item";
          label.id = `prof-${prof}`;

          const contentDiv = document.createElement("div");
          contentDiv.className = "prof-item-content";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.value = prof;

          const span = document.createElement("span");
          span.textContent = prof;

          contentDiv.appendChild(checkbox);
          contentDiv.appendChild(span);
          label.appendChild(contentDiv);

          // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
          const indicatorsDiv = document.createElement("div");
          indicatorsDiv.className = "conflict-indicators";
          indicatorsDiv.id = `conflict-${prof}`;
          label.appendChild(indicatorsDiv);

          label.appendChild(createDayBadge(prof));

          checkbox.addEventListener("change", () => {
            updatePlayerProfession(prof, checkbox.checked);
            refreshProfessions();
            saveState();
          });

          listDiv.appendChild(label);
        });

        catDiv.appendChild(listDiv);
        container.appendChild(catDiv);
      }
    }

    function renderServerProfessions() {
      serverList.innerHTML = "";
      for (const [catName, profs] of Object.entries(categories)) {
        const catDiv = document.createElement("div");
        catDiv.style.display = "flex";
        catDiv.style.flexWrap = "wrap";
        catDiv.style.gap = "6px";
        catDiv.style.marginBottom = "4px";

        profs.forEach(prof => {
          const label = document.createElement("label");
          label.className = "server-item";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.value = prof;

          const span = document.createElement("span");
          span.textContent = prof;

          label.appendChild(checkbox);
          label.appendChild(span);
          label.appendChild(createDayBadge(prof));

          checkbox.addEventListener("change", () => {
            refreshProfessions();
            saveState();
          });

          catDiv.appendChild(label);
        });
        serverList.appendChild(catDiv);
      }
    }

    function updatePlayerProfession(profession, isSelected) {
      const activePlayer = players.find(p => p.id === activePlayerId);
      if (!activePlayer) return;

      if (isSelected) {
        if (!activePlayer.professions.includes(profession)) {
          activePlayer.professions.push(profession);
        }
      } else {
        activePlayer.professions = activePlayer.professions.filter(p => p !== profession);
      }

      renderPlayers();
    }

    function updateConflictVisualization() {
      const activePlayer = players.find(p => p.id === activePlayerId);
      if (!activePlayer) return;

      // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –≤—Å–µ—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
      const allSelectedProfs = new Map();
      players.forEach(player => {
        player.professions.forEach(prof => {
          if (!allSelectedProfs.has(prof)) {
            allSelectedProfs.set(prof, []);
          }
          allSelectedProfs.get(prof).push(player);
        });
      });

      // –û—á–∏—â–∞–µ–º –≤—Å–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
      container.querySelectorAll(".prof-item").forEach(item => {
        item.classList.remove("conflict");
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–≤–µ—Ä–ª–µ–∏
        const oldOverlay = item.querySelector(".conflict-overlay");
        const oldGradient = item.querySelector(".gradient-overlay");
        if (oldOverlay) oldOverlay.remove();
        if (oldGradient) oldGradient.remove();

        // –û—á–∏—â–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
        const indicatorsDiv = item.querySelector(".conflict-indicators");
        if (indicatorsDiv) indicatorsDiv.innerHTML = "";
      });

      // –î–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
      activePlayer.professions.forEach(prof => {
        if (conflicts[prof]) {
          conflicts[prof].forEach(conflictedProf => {
            const playersWithConflict = allSelectedProfs.get(conflictedProf) || [];

            playersWithConflict.forEach(player => {
              if (player.id !== activePlayerId) {
                const item = document.getElementById(`prof-${conflictedProf}`);
                if (item && !item.classList.contains("selected") && !item.classList.contains("other-player-selected")) {
                  visualizeConflict(item, [player], `–ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å ${player.name} (${prof} ‚Üî ${conflictedProf})`);
                }
              }
            });
          });
        }
      });

      // –¢–∞–∫–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –∞–∫—Ç–∏–≤–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂ —Ö–æ—á–µ—Ç –≤—ã–±—Ä–∞—Ç—å
      container.querySelectorAll(".prof-item").forEach(item => {
        const cb = item.querySelector("input[type='checkbox']");
        const profName = cb.value;

        if (!cb.checked && conflicts[profName] && !item.classList.contains("other-player-selected")) {
          const conflictPlayers = [];
          let conflictInfo = "";

          conflicts[profName].forEach(conflictedProf => {
            const playersWithConflict = allSelectedProfs.get(conflictedProf) || [];
            playersWithConflict.forEach(player => {
              if (player.id !== activePlayerId && !conflictPlayers.find(p => p.id === player.id)) {
                conflictPlayers.push(player);
                conflictInfo += `–ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å ${player.name} (${profName} ‚Üî ${conflictedProf})\n`;
              }
            });
          });

          if (conflictPlayers.length > 0) {
            visualizeConflict(item, conflictPlayers, conflictInfo.trim());
          }
        }
      });
    }

    function visualizeConflict(item, conflictPlayers, tooltipText) {
      item.classList.add("conflict");

      // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—É—é –∑–∞–ª–∏–≤–∫—É –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
      if (conflictPlayers.length === 1) {
        // –û–¥–∏–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç - —Å–ø–ª–æ—à–Ω–æ–π —Ü–≤–µ—Ç
        const overlay = document.createElement("div");
        overlay.className = "conflict-overlay";
        overlay.style.backgroundColor = conflictPlayers[0].color;
        overlay.title = tooltipText;
        item.appendChild(overlay);
      } else {
        // –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ - –≥—Ä–∞–¥–∏–µ–Ω—Ç
        const gradient = document.createElement("div");
        gradient.className = "gradient-overlay";

        // –°–æ–∑–¥–∞–µ–º –ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –∏–∑ —Ü–≤–µ—Ç–æ–≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
        const gradientColors = conflictPlayers.map(player => player.color);
        gradient.style.background = `linear-gradient(90deg, ${gradientColors.join(', ')})`;
        gradient.title = tooltipText;
        item.appendChild(gradient);
      }

      // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (—Ç–æ—á–∫–∏) –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
      const indicatorsDiv = item.querySelector(".conflict-indicators");
      if (indicatorsDiv) {
        conflictPlayers.forEach(player => {
          const indicator = document.createElement("div");
          indicator.className = "conflict-indicator";
          indicator.style.backgroundColor = player.color;

          const tooltip = document.createElement("div");
          tooltip.className = "conflict-tooltip";
          tooltip.textContent = `–ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å ${player.name}`;

          indicator.appendChild(tooltip);
          indicatorsDiv.appendChild(indicator);
        });
      }
    }

    // ====== –¢–µ–º–∞ ======
    function toggleTheme() {
      const currentTheme = document.body.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.body.setAttribute('data-theme', newTheme);
      updateThemeButton();
      saveState();
    }

    function updateThemeButton() {
      const currentTheme = document.body.getAttribute('data-theme') || 'light';
      const icon = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
      const text = currentTheme === 'dark' ? '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞' : '–¢—ë–º–Ω–∞—è —Ç–µ–º–∞';
      themeToggle.innerHTML = `<span>${icon}</span> ${text}`;
    }

    themeToggle.addEventListener('click', toggleTheme);

    // ====== –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ ======
    function refreshProfessions() {
      const showAll = showAllToggle.checked;
      const serverDayValue = serverDayInput.value.trim();
      const serverDay = serverDayValue === '' ? -1 : parseInt(serverDayValue, 10);

      const selectedServerProfs = Array.from(serverList.querySelectorAll("input[type='checkbox']:checked")).map(cb => cb.value);
      const activePlayer = players.find(p => p.id === activePlayerId);
      const selectedMainProfs = activePlayer ? activePlayer.professions : [];

      // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏, –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–∏–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏
      const otherPlayersProfs = new Map();
      players.forEach(player => {
        if (player.id !== activePlayerId) {
          player.professions.forEach(prof => {
            if (!otherPlayersProfs.has(prof)) {
              otherPlayersProfs.set(prof, []);
            }
            otherPlayersProfs.get(prof).push(player);
          });
        }
      });

      // –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
      const disabledProfs = new Set();

      // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ë–ê–ì–ê: —É—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏—è–º–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
      selectedMainProfs.forEach(sel => {
        if (conflicts[sel]) {
          conflicts[sel].forEach(c => {
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏—è –Ω–µ –≤—ã–±—Ä–∞–Ω–∞ –∞–∫—Ç–∏–≤–Ω—ã–º –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º
            if (!selectedMainProfs.includes(c)) {
              disabledProfs.add(c);
            }
          });
        }
      });

      // --- –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏—Å–æ–∫ ---
      container.querySelectorAll(".prof-item").forEach(item => {
        const cb = item.querySelector("input[type='checkbox']");
        const profName = cb.value;
        const day = professionDays[profName] || 0;

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        item.classList.remove("server-prof", "selected", "disabled", "hidden", "other-player-selected");
        cb.disabled = false;

        // –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏
        if (selectedServerProfs.includes(profName)) {
          cb.checked = false;
          cb.disabled = true;
          item.classList.add("server-prof");
          item.style.display = 'flex';
          return;
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–Ω—é
        if (!showAll && serverDay !== -1 && day > serverDay) {
          item.style.display = 'none';
          cb.checked = false;
          return;
        }

        item.style.display = 'flex';

        // –í—ã–±—Ä–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –∞–∫—Ç–∏–≤–Ω—ã–º –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º
        if (selectedMainProfs.includes(profName)) {
          item.classList.add("selected");
        }
        // –ü—Ä–æ—Ñ–µ—Å—Å–∏–∏, –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–∏–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ (–ù–û–í–û–ï: –∫—Ä–∞—Å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –ü–†–ò–û–†–ò–¢–ï–¢–û–ú)
        else if (otherPlayersProfs.has(profName)) {
          item.classList.add("other-player-selected");
          // –£–±–∏—Ä–∞–µ–º –ª—é–±—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç-–æ–≤–µ—Ä–ª–µ–∏ –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–π, –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥—Ä—É–≥–∏–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏
          const overlay = item.querySelector(".conflict-overlay");
          const gradient = item.querySelector(".gradient-overlay");
          if (overlay) overlay.remove();
          if (gradient) gradient.remove();
        }

        // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ (–∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Ç–µ–∫—É—â–∏–º –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º)
        if (disabledProfs.has(profName) && !selectedMainProfs.includes(profName)) {
          item.classList.add("disabled");
          cb.disabled = true; // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—ã–±–æ—Ä
        }
      });

      // --- –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ ---
      serverList.querySelectorAll(".server-item").forEach(item => {
        const cb = item.querySelector("input[type='checkbox']");
        const profName = cb.value;
        const day = professionDays[profName] || 0;

        if (!showAll && serverDay !== -1 && day > serverDay) {
          item.style.display = 'none';
          cb.checked = false;
          item.classList.remove("selected");
        } else {
          item.style.display = 'flex';
          item.classList.toggle("selected", cb.checked);
        }
      });

      // --- –ë–ª–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏–π ---
      if (disabledProfs.size > 0) {
        disabledBlock.style.display = "block";
        disabledCount.textContent = disabledProfs.size;
        disabledList.innerHTML = "";
        disabledProfs.forEach(p => {
          const li = document.createElement("li");
          li.textContent = p;
          disabledList.appendChild(li);
        });
      } else {
        disabledBlock.style.display = "none";
      }

      // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ-–≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–π)
      updateConflictVisualization();

      warningMessage.style.display = showAll ? 'block' : 'none';
      dayControlGroup.classList.toggle('hidden', showAll);
      serverCount.textContent = selectedServerProfs.length;
    }

    // ====== –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π ======
    function setupEventListeners() {
      serverDayInput.addEventListener('input', () => {
        refreshProfessions();
        saveState();
      });

      showAllToggle.addEventListener('change', () => {
        refreshProfessions();
        saveState();
      });

      addPlayerBtn.addEventListener('click', addPlayer);
      removePlayerBtn.addEventListener('click', removePlayer);

      resetBtn.addEventListener('click', () => {
        players.forEach(player => {
          player.professions = [];
        });

        serverList.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
        serverDayInput.value = '';
        showAllToggle.checked = false;

        renderPlayers();
        refreshProfessions();
        saveState();
      });

      document.addEventListener('change', (e) => {
        if (e.target.type === 'checkbox') {
          setTimeout(() => {
            refreshProfessions();
            saveState();
          }, 10);
        }
      });
    }

    // ====== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ======
    function init() {
      renderMainProfessions();
      renderServerProfessions();
      renderPlayers();
      setupEventListeners();
      setupTutorialEventListeners();
      loadState();
      updateThemeButton();

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç—É—Ç–æ—Ä–∏–∞–ª –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
      setTimeout(showTutorial, 500);
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>

</html>